#if( ${containerObject} )
#set( $appName = "Container-${containerObject.getName()}" )
#else
#set( $appName = $aib.getApplicationNameFormatted() )
#end
#### CI CONFIG
language: python

python:
  - 3.7

build:
  cache:  true
  ci:
#### Running tests using pytest

    - '[ $EUID == 0 ] && SUDO="" || SUDO=sudo'
    - $SUDO pip install pipenv
    - pipenv install
    - pipenv install Django
    - pipenv install pytest-django
    - pipenv run pytest --junitxml=shippable/testresults/junit.xml ${appName}/tests
#if( ${aib.getParam('nexus.inUse')} == "true" )
#set( $repoName = "nexusRepo" )
#set( $nexusUserName = ${aib.getParam('nexus.userName')} )
#set( $nexusPassword = ${aib.getParam('nexus.password')} )
#set( $nexusRepoUrl = ${aib.getParam('nexus.repoUrl')} )
    - cd ${appName}
    - echo creating distribution
    - python setup.py sdist    
    - echo -e "[distutils]" >> ~/.pypirc
    - echo -e "index-servers = ${repoName}" >> ~/.pypirc
    - echo -e "[${repoName}]" >> ~/.pypirc
    - echo -e "username = ${nexusUserName}" >> ~/.pypirc
    - echo -e "password = ${nexusPassword}" >> ~/.pypirc
    - echo -e "repository = ${nexusRepoUrl}" >> ~/.pypirc    
    - echo installing twine
    - pip install twine
    - echo upload archive to ${repoName} repo
    - twine upload -r ${repoName} dist/*.gz
#end##if ( ${aib.getParam('nexus.inUse')} == "true" )

#### END CI CONFIG
