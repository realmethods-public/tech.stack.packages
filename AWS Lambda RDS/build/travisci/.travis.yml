language: java

git:
  depth: false
  quiet: true

env:
  - DATABASE_USERNAME=root DATABASE_PASSWORD= DATABASE_DIALECT=org.hibernate.dialect.MySQL5Dialect

before_install:
- echo -e "machine github.com\n  login $GITHUB_TOKEN" > ~/.netrc
- git lfs pull

script:  
  # first run test using JUnit
  - mvn dependency:go-offline test -f pom-restful-api.xml
  
  # using maven to first package then to deploy the generated Lambda functions.  
  # The key vars (USER_AWS_ACCESSKEY and USER_AWS_SECRETKEY) are read in as env vars for the current project.
  # See https://docs.travis-ci.com/user/environment-variables/#defining-variables-in-repository-settings
  - mvn package lambda:delete-lambda lambda:deploy-lambda -f pom-aws-lambda.xml  -DAWS_ACCESSKEY=$USER_AWS_ACCESSKEY -DAWS_SECRETKEY=$USER_AWS_SECRETKEY # deploy the lambda functions 
  
services:
  - mysql
